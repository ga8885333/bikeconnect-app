<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¢ç´¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Leaflet åœ°åœ– (å…è²»ï¼Œç„¡éœ€API Key) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* å¤œé–“æ¨¡å¼æ”¯æŒ */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-tertiary: #9ca3af;
            --border-color: #e5e7eb;
            --card-bg: #ffffff;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-tertiary: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-tertiary: #9ca3af;
            --border-color: #4b5563;
            --card-bg: #374151;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4);
        }

        body {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .card-bg {
            background-color: var(--card-bg);
            border-color: var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .text-tertiary { color: var(--text-tertiary); }

        .map-container {
            background: linear-gradient(45deg, #fef3c7, #fed7aa);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
        }
        .route-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .filter-chip {
            transition: all 0.2s ease;
        }
        .filter-chip.active {
            background: #f59e0b;
            color: white;
        }
        
        /* å®šä½æŒ‰éˆ•ç‰¹æ®Šæ¨£å¼ */
        #centerLocationBtn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border: 3px solid rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            animation: locationPulse 2s infinite;
            z-index: 1000;
            position: relative;
        }
        
        #centerLocationBtn:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
        }
        
        #centerLocationBtn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        @keyframes locationPulse {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
            }
            50% {
                box-shadow: 0 4px 25px rgba(245, 158, 11, 0.5);
            }
        }
        
        /* ç•¶å‰ä½ç½®æ¨™è¨˜æ¨£å¼ */
        .current-location-marker {
            animation: locationBlink 1.5s infinite;
        }
        
        @keyframes locationBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* ç¢ºä¿åœ°åœ–æ§ä»¶åœ¨æ­£ç¢ºå±¤ç´š */
        .leaflet-control-container {
            z-index: 999;
        }
        
        /* åœ°åœ–æœ¬èº« */
        #map {
            z-index: 1;
        }
    </style>
</head>
<body>
    <!-- æœå°‹æ¬„ -->
    <div class="card-bg p-4 border-b">
        <div class="relative">
            <input type="text" id="searchInput" placeholder="æœå°‹åœ°é»ã€è·¯ç·šæˆ–é¨å‹..." 
                   class="w-full pl-10 pr-16 py-3 rounded-xl border-none focus:ring-2 focus:ring-amber-500 focus:outline-none text-primary" 
                   style="background-color: var(--bg-tertiary);">
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-tertiary"></i>
            <button id="searchBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-amber-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-amber-600 transition-colors">
                æœå°‹
            </button>
        </div>
        
        <!-- å¿«é€Ÿæœå°‹å»ºè­° -->
        <div class="flex space-x-2 mt-3 overflow-x-auto pb-1">
            <button class="quick-search flex-shrink-0 bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm" data-location="æ¿æ©‹å€">
                ğŸ“ æ¿æ©‹å€
            </button>
            <button class="quick-search flex-shrink-0 bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm" data-location="æ·¡æ°´">
                ğŸŒŠ æ·¡æ°´
            </button>
            <button class="quick-search flex-shrink-0 bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm" data-location="é™½æ˜å±±">
                ğŸ”ï¸ é™½æ˜å±±
            </button>
            <button class="quick-search flex-shrink-0 bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm" data-location="ä¿¡ç¾©å€">
                ğŸ™ï¸ ä¿¡ç¾©å€
            </button>
        </div>
    </div>

    <!-- åœ°åœ–è¦–åœ– -->
    <div class="relative">
        <div id="map" class="h-64 border-b"></div>
        <!-- åœ°åœ–æ§åˆ¶æŒ‰éˆ• -->
        <div class="absolute top-4 right-4 space-y-2">
            <button id="currentLocationBtn" class="card-bg rounded-full w-12 h-12 shadow-lg flex items-center justify-center hover:shadow-xl transition-shadow">
                <i class="fas fa-location-arrow text-amber-600"></i>
            </button>
            <button id="landmarksBtn" class="card-bg rounded-full w-12 h-12 shadow-lg flex items-center justify-center hover:shadow-xl transition-shadow">
                <i class="fas fa-map-marker-alt text-secondary"></i>
            </button>
        </div>
        
        <!-- ä¸»è¦å®šä½æŒ‰éˆ• -->
        <div class="absolute bottom-24 right-4 z-50">
            <button id="centerLocationBtn" class="bg-amber-600 hover:bg-amber-700 text-white rounded-full w-16 h-16 shadow-xl flex items-center justify-center transition-all duration-200 hover:scale-105">
                <i class="fas fa-crosshairs text-2xl"></i>
            </button>
        </div>
        
        <!-- åœ°åœ–åº•éƒ¨æ“ä½œæ¬„ -->
        <div class="absolute bottom-4 left-4 right-4">
            <div class="card-bg rounded-xl p-3 shadow-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="bg-yellow-100 rounded-full p-2">
                            <i class="fas fa-coffee text-yellow-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-primary">ç†±é–€åœ°æ¨™</p>
                            <p class="text-xs text-tertiary">é»æ“Šåœ°æ¨™ä½¿ç”¨åŸç”Ÿå°èˆª</p>
                        </div>
                    </div>
                    <button id="toggleLandmarks" class="text-amber-600 font-medium">é¡¯ç¤º</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¯©é¸æ¨™ç±¤ -->
    <div class="p-4">
        <div class="flex space-x-2 overflow-x-auto pb-2">
            <button class="filter-chip active flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700">
                å…¨éƒ¨
            </button>
            <button class="filter-chip flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700">
                <i class="fas fa-mountain mr-1"></i>
                çˆ¬å¡è·¯ç·š
            </button>
            <button class="filter-chip flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700">
                <i class="fas fa-leaf mr-1"></i>
                ä¼‘é–’è·¯ç·š
            </button>
            <button class="filter-chip flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700">
                <i class="fas fa-road mr-1"></i>
                å…¬è·¯é¨è¡Œ
            </button>
            <button class="filter-chip flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-700">
                <i class="fas fa-tree mr-1"></i>
                è¶Šé‡è·¯ç·š
            </button>
        </div>
    </div>

    <!-- ç†±é–€è·¯ç·š -->
    <div class="px-4">
        <div class="flex items-center justify-between mb-4">
            <h3 class="font-bold text-lg text-primary">ç†±é–€è·¯ç·š</h3>
            <button class="text-amber-600 font-medium">æŸ¥çœ‹æ›´å¤š</button>
        </div>
        
        <div class="space-y-4">
            <!-- è·¯ç·šå¡ç‰‡1 -->
            <div class="route-card card-bg rounded-xl shadow-sm border overflow-hidden transition-all duration-200">
                <div class="h-32 bg-gradient-to-r from-green-400 to-blue-500 relative">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-image text-white text-3xl opacity-75"></i>
                    </div>
                    <!-- å„ªåŒ–é›£åº¦æ¨™ç±¤ -->
                    <div class="absolute top-3 left-3 flex space-x-2">
                        <span class="bg-green-500 text-white text-xs px-3 py-1 rounded-full font-medium flex items-center">
                            <i class="fas fa-leaf mr-1"></i>åˆç´š
                        </span>
                        <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full">
                            <i class="fas fa-dumbbell mr-1"></i>è¼•é¬†
                        </span>
                    </div>
                    <div class="absolute top-3 right-3">
                        <button class="bg-white/20 backdrop-blur-sm rounded-full w-8 h-8 flex items-center justify-center">
                            <i class="far fa-heart text-white"></i>
                        </button>
                    </div>
                </div>
                <div class="p-4">
                    <h4 class="font-semibold text-primary mb-2">æ·¡æ°´æ²³æ¿±è‡ªè¡Œè»Šé“</h4>
                    <p class="text-sm text-secondary mb-3">æ²¿æ²³é¢¨æ™¯å„ªç¾ï¼Œé©åˆå…¨å®¶å¤§å°çš„ä¼‘é–’è·¯ç·š</p>
                    
                    <!-- è©³ç´°é›£åº¦ä¿¡æ¯ -->
                    <div class="bg-gray-50 rounded-lg p-3 mb-3" style="background-color: var(--bg-tertiary);">
                        <div class="grid grid-cols-3 gap-2 text-xs">
                            <div class="text-center">
                                <div class="text-green-600 font-semibold">å¡åº¦</div>
                                <div class="text-secondary">å¹³ç·©</div>
                            </div>
                            <div class="text-center">
                                <div class="text-blue-600 font-semibold">è·¯æ³</div>
                                <div class="text-secondary">å„ªè‰¯</div>
                            </div>
                            <div class="text-center">
                                <div class="text-purple-600 font-semibold">é¢¨æ™¯</div>
                                <div class="text-secondary">â˜…â˜…â˜…â˜…â˜†</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between text-sm">
                        <div class="flex items-center space-x-4 text-tertiary">
                            <span><i class="fas fa-route mr-1"></i>18.5km</span>
                            <span><i class="fas fa-clock mr-1"></i>1.2å°æ™‚</span>
                            <span><i class="fas fa-fire mr-1"></i>320å¡</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i class="fas fa-star text-yellow-500"></i>
                            <span class="font-medium">4.8</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between mt-3 pt-3 border-t" style="border-color: var(--border-color);">
                        <div class="flex items-center space-x-2">
                            <div class="flex -space-x-2">
                                <img src="https://via.placeholder.com/24x24/3b82f6/ffffff?text=A" class="w-6 h-6 rounded-full border-2 border-white">
                                <img src="https://via.placeholder.com/24x24/8b5cf6/ffffff?text=B" class="w-6 h-6 rounded-full border-2 border-white">
                                <img src="https://via.placeholder.com/24x24/f59e0b/ffffff?text=C" class="w-6 h-6 rounded-full border-2 border-white">
                            </div>
                            <span class="text-xs text-tertiary">+127ä½é¨å‹</span>
                        </div>
                        <button class="bg-amber-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-amber-700 transition-colors">
                            é–‹å§‹é¨è¡Œ
                        </button>
                    </div>
                </div>
            </div>

            <!-- è·¯ç·šå¡ç‰‡2 -->
            <div class="route-card card-bg rounded-xl shadow-sm border overflow-hidden transition-all duration-200">
                <div class="h-32 bg-gradient-to-r from-orange-400 to-red-500 relative">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-image text-white text-3xl opacity-75"></i>
                    </div>
                    <!-- å„ªåŒ–é›£åº¦æ¨™ç±¤ -->
                    <div class="absolute top-3 left-3 flex space-x-2">
                        <span class="bg-orange-500 text-white text-xs px-3 py-1 rounded-full font-medium flex items-center">
                            <i class="fas fa-mountain mr-1"></i>ä¸­ç´š
                        </span>
                        <span class="bg-yellow-500 text-white text-xs px-2 py-1 rounded-full">
                            <i class="fas fa-dumbbell mr-1"></i>ä¸­ç­‰
                        </span>
                    </div>
                    <div class="absolute top-3 right-3">
                        <button class="bg-white/20 backdrop-blur-sm rounded-full w-8 h-8 flex items-center justify-center">
                            <i class="fas fa-heart text-red-500"></i>
                        </button>
                    </div>
                </div>
                <div class="p-4">
                    <h4 class="font-semibold text-primary mb-2">é™½æ˜å±±åœ‹å®¶å…¬åœ’</h4>
                    <p class="text-sm text-secondary mb-3">æŒ‘æˆ°æ€§çˆ¬å¡è·¯ç·šï¼Œå±±é ‚é¢¨æ™¯çµ•ä½³</p>
                    
                    <!-- è©³ç´°é›£åº¦ä¿¡æ¯ -->
                    <div class="bg-gray-50 rounded-lg p-3 mb-3" style="background-color: var(--bg-tertiary);">
                        <div class="grid grid-cols-3 gap-2 text-xs">
                            <div class="text-center">
                                <div class="text-orange-600 font-semibold">å¡åº¦</div>
                                <div class="text-secondary">é™¡å³­</div>
                            </div>
                            <div class="text-center">
                                <div class="text-yellow-600 font-semibold">è·¯æ³</div>
                                <div class="text-secondary">è‰¯å¥½</div>
                            </div>
                            <div class="text-center">
                                <div class="text-purple-600 font-semibold">é¢¨æ™¯</div>
                                <div class="text-secondary">â˜…â˜…â˜…â˜…â˜…</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between text-sm">
                        <div class="flex items-center space-x-4 text-tertiary">
                            <span><i class="fas fa-route mr-1"></i>25.8km</span>
                            <span><i class="fas fa-clock mr-1"></i>2.5å°æ™‚</span>
                            <span><i class="fas fa-fire mr-1"></i>850å¡</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i class="fas fa-star text-yellow-500"></i>
                            <span class="font-medium">4.6</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between mt-3 pt-3 border-t" style="border-color: var(--border-color);">
                        <div class="flex items-center space-x-2">
                            <div class="flex -space-x-2">
                                <img src="https://via.placeholder.com/24x24/ef4444/ffffff?text=D" class="w-6 h-6 rounded-full border-2 border-white">
                                <img src="https://via.placeholder.com/24x24/22c55e/ffffff?text=E" class="w-6 h-6 rounded-full border-2 border-white">
                            </div>
                            <span class="text-xs text-tertiary">+83ä½é¨å‹</span>
                        </div>
                        <button class="bg-amber-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-amber-700 transition-colors">
                            é–‹å§‹é¨è¡Œ
                        </button>
                    </div>
                </div>
            </div>

            <!-- è·¯ç·šå¡ç‰‡3 -->
            <div class="route-card card-bg rounded-xl shadow-sm border overflow-hidden transition-all duration-200">
                <div class="h-32 bg-gradient-to-r from-purple-400 to-pink-500 relative">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-image text-white text-3xl opacity-75"></i>
                    </div>
                    <!-- å„ªåŒ–é›£åº¦æ¨™ç±¤ -->
                    <div class="absolute top-3 left-3 flex space-x-2">
                        <span class="bg-red-500 text-white text-xs px-3 py-1 rounded-full font-medium flex items-center">
                            <i class="fas fa-fire mr-1"></i>é«˜ç´š
                        </span>
                        <span class="bg-red-600 text-white text-xs px-2 py-1 rounded-full">
                            <i class="fas fa-dumbbell mr-1"></i>å›°é›£
                        </span>
                    </div>
                    <div class="absolute top-3 right-3">
                        <button class="bg-white/20 backdrop-blur-sm rounded-full w-8 h-8 flex items-center justify-center">
                            <i class="far fa-heart text-white"></i>
                        </button>
                    </div>
                </div>
                <div class="p-4">
                    <h4 class="font-semibold text-primary mb-2">åŒ—æµ·å²¸ç’°å³¶è·¯ç·š</h4>
                    <p class="text-sm text-secondary mb-3">æµ·æ™¯å…¬è·¯ï¼Œé©åˆé‡æ©Ÿé¨å£«çš„é•·é€”è·¯ç·š</p>
                    
                    <!-- è©³ç´°é›£åº¦ä¿¡æ¯ -->
                    <div class="bg-gray-50 rounded-lg p-3 mb-3" style="background-color: var(--bg-tertiary);">
                        <div class="grid grid-cols-3 gap-2 text-xs">
                            <div class="text-center">
                                <div class="text-red-600 font-semibold">å¡åº¦</div>
                                <div class="text-secondary">å¤šè®Š</div>
                            </div>
                            <div class="text-center">
                                <div class="text-orange-600 font-semibold">è·¯æ³</div>
                                <div class="text-secondary">è¤‡é›œ</div>
                            </div>
                            <div class="text-center">
                                <div class="text-purple-600 font-semibold">é¢¨æ™¯</div>
                                <div class="text-secondary">â˜…â˜…â˜…â˜…â˜…</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between text-sm">
                        <div class="flex items-center space-x-4 text-tertiary">
                            <span><i class="fas fa-route mr-1"></i>68.2km</span>
                            <span><i class="fas fa-clock mr-1"></i>4.5å°æ™‚</span>
                            <span><i class="fas fa-fire mr-1"></i>1250å¡</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i class="fas fa-star text-yellow-500"></i>
                            <span class="font-medium">4.9</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between mt-3 pt-3 border-t" style="border-color: var(--border-color);">
                        <div class="flex items-center space-x-2">
                            <div class="flex -space-x-2">
                                <img src="https://via.placeholder.com/24x24/6366f1/ffffff?text=F" class="w-6 h-6 rounded-full border-2 border-white">
                                <img src="https://via.placeholder.com/24x24/10b981/ffffff?text=G" class="w-6 h-6 rounded-full border-2 border-white">
                                <img src="https://via.placeholder.com/24x24/f97316/ffffff?text=H" class="w-6 h-6 rounded-full border-2 border-white">
                            </div>
                            <span class="text-xs text-tertiary">+45ä½é¨å‹</span>
                        </div>
                        <button class="bg-amber-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-amber-700 transition-colors">
                            é–‹å§‹é¨è¡Œ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é™„è¿‘é¨å‹ -->
    <div class="px-4 mt-8">
        <div class="flex items-center justify-between mb-4">
            <h3 class="font-bold text-lg text-primary">é™„è¿‘é¨å‹</h3>
            <button class="text-amber-600 font-medium">æŸ¥çœ‹æ›´å¤š</button>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
            <div class="card-bg rounded-xl p-4 shadow-sm border">
                <div class="flex items-center space-x-3 mb-3">
                    <img src="https://via.placeholder.com/40x40/3b82f6/ffffff?text=A" class="w-10 h-10 rounded-full">
                    <div>
                        <h4 class="font-medium text-primary">é˜¿å¼·</h4>
                        <p class="text-xs text-tertiary">0.8km â€¢ ç·šä¸Š</p>
                    </div>
                </div>
                <div class="text-xs text-secondary mb-3">
                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">é‡æ©Ÿ</span>
                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full ml-1">æ–°æ‰‹</span>
                </div>
                <button class="w-full bg-amber-600 text-white py-2 rounded-lg text-sm font-medium hover:bg-amber-700 transition-colors">
                    æ‰“æ‹›å‘¼
                </button>
            </div>
            
            <div class="card-bg rounded-xl p-4 shadow-sm border">
                <div class="flex items-center space-x-3 mb-3">
                    <img src="https://via.placeholder.com/40x40/8b5cf6/ffffff?text=M" class="w-10 h-10 rounded-full">
                    <div>
                        <h4 class="font-medium text-primary">å°ç¾</h4>
                        <p class="text-xs text-tertiary">1.2km â€¢ é¨è¡Œä¸­</p>
                    </div>
                </div>
                <div class="text-xs text-secondary mb-3">
                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full">å…¬è·¯è»Š</span>
                    <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full ml-1">è€æ‰‹</span>
                </div>
                <button class="w-full bg-amber-600 text-white py-2 rounded-lg text-sm font-medium hover:bg-amber-700 transition-colors">
                    é–‹å§‹é¨è¡Œ
                </button>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ç©ºé–“ -->
    <div class="h-20"></div>

    <script>
        // ç°¡åŒ–ç‰ˆåœ°åœ–åŠŸèƒ½ (ä½¿ç”¨ Leaflet)
        let map;
        let currentLocationMarker;
        let landmarkMarkers = [];
        let userLocation = null;
        let landmarksVisible = false;
        
        // ç†±é–€åœ°æ¨™æ•¸æ“š
        const landmarks = [
            {
                name: "æ¿æ©‹è»Šç«™æ˜Ÿå·´å…‹",
                position: [25.0138, 121.4627], // Leafletä½¿ç”¨ [lat, lng] æ ¼å¼
                category: "å’–å•¡å»³",
                icon: "â˜•",
                color: "#8B4513"
            },
            {
                name: "æ·¡æ°´è€è¡—",
                position: [25.1757, 121.4413],
                category: "æ™¯é»",
                icon: "ğŸ®",
                color: "#FF6B6B"
            },
            {
                name: "é™½æ˜å±±åœ‹å®¶å…¬åœ’",
                position: [25.1903, 121.5494],
                category: "æ™¯é»",
                icon: "ğŸ”ï¸",
                color: "#4ECDC4"
            },
            {
                name: "ä¿¡ç¾©å€æ–°å…‰ä¸‰è¶Š",
                position: [25.0360, 121.5636],
                category: "è³¼ç‰©",
                icon: "ğŸ›ï¸",
                color: "#45B7D1"
            },
            {
                name: "å£«æ—å¤œå¸‚",
                position: [25.0881, 121.5240],
                category: "ç¾é£Ÿ",
                icon: "ğŸœ",
                color: "#F39C12"
            },
            {
                name: "è¥¿é–€ç”º",
                position: [25.0421, 121.5071],
                category: "æ™¯é»",
                icon: "ğŸ¬",
                color: "#9B59B6"
            },
            {
                name: "ä¸­æ­£ç´€å¿µå ‚",
                position: [25.0361, 121.5200],
                category: "æ™¯é»",
                icon: "ğŸ›ï¸",
                color: "#E74C3C"
            },
            {
                name: "å°åŒ—101",
                position: [25.0340, 121.5645],
                category: "æ™¯é»",
                icon: "ğŸ—ï¸",
                color: "#2ECC71"
            }
        ];
        
        // åˆå§‹åŒ–åœ°åœ–
        function initMap() {
            // é è¨­ä½ç½®ï¼šå°åŒ—è»Šç«™
            const defaultLocation = [25.0478, 121.5170];
            
            // å‰µå»º Leaflet åœ°åœ–
            map = L.map('map').setView(defaultLocation, 12);
            
            // æ·»åŠ åœ°åœ–åœ–å±¤
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19
            }).addTo(map);
            
            // å˜—è©¦ç²å–ç”¨æˆ¶ä½ç½®
            getCurrentLocation();
            
            console.log('ğŸ—ºï¸ Leaflet åœ°åœ–å·²åˆå§‹åŒ–');
        }
        
        // ç²å–ç•¶å‰ä½ç½® (å¢å¼·ç‰ˆ)
        function getCurrentLocation(showLoading = false) {
            const locationBtn = document.getElementById('centerLocationBtn');
            const currentBtn = document.getElementById('currentLocationBtn');
            
            if (showLoading) {
                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                locationBtn.innerHTML = '<i class="fas fa-spinner fa-spin text-xl"></i>';
                locationBtn.disabled = true;
            }
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    userLocation = [position.coords.latitude, position.coords.longitude];
                    
                    // æ·»åŠ ç•¶å‰ä½ç½®æ¨™è¨˜
                    if (currentLocationMarker) {
                        currentLocationMarker.remove();
                    }
                    
                    // å‰µå»ºè—è‰²æ¨™è¨˜è¡¨ç¤ºç•¶å‰ä½ç½®
                    const blueIcon = L.divIcon({
                        className: 'current-location-marker',
                        html: '<div style="background-color: #3b82f6; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    });
                    
                    currentLocationMarker = L.marker(userLocation, { icon: blueIcon }).addTo(map)
                        .bindPopup('ğŸ“ æ‚¨çš„ä½ç½®')
                        .openPopup();
                    
                    // ç§»å‹•åœ°åœ–åˆ°ç•¶å‰ä½ç½®
                    map.setView(userLocation, 16);
                    
                    // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                    if (showLoading) {
                        locationBtn.innerHTML = '<i class="fas fa-crosshairs text-xl"></i>';
                        locationBtn.disabled = false;
                        
                        // çŸ­æš«é¡¯ç¤ºæˆåŠŸç‹€æ…‹
                        locationBtn.classList.add('bg-green-600');
                        setTimeout(() => {
                            locationBtn.classList.remove('bg-green-600');
                        }, 1000);
                    }
                    
                    console.log('ğŸ“ å·²ç²å–ç•¶å‰ä½ç½®');
                }, (error) => {
                    console.log('âŒ ç„¡æ³•ç²å–ä½ç½®:', error.message);
                    
                    // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹ä¸¦é¡¯ç¤ºéŒ¯èª¤
                    if (showLoading) {
                        locationBtn.innerHTML = '<i class="fas fa-exclamation-triangle text-xl"></i>';
                        locationBtn.classList.add('bg-red-600');
                        
                        setTimeout(() => {
                            locationBtn.innerHTML = '<i class="fas fa-crosshairs text-xl"></i>';
                            locationBtn.classList.remove('bg-red-600');
                            locationBtn.disabled = false;
                        }, 2000);
                    }
                    
                    // é¡¯ç¤ºéŒ¯èª¤æç¤º
                    alert('ç„¡æ³•ç²å–ä½ç½®è³‡è¨Š\nè«‹ç¢ºèªï¼š\n1. å·²å…è¨±ä½ç½®å­˜å–æ¬Šé™\n2. GPSåŠŸèƒ½å·²é–‹å•Ÿ\n3. ç¶²è·¯é€£ç·šæ­£å¸¸');
                }, {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                });
            } else {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´åœ°ç†å®šä½åŠŸèƒ½');
                if (showLoading) {
                    locationBtn.innerHTML = '<i class="fas fa-crosshairs text-xl"></i>';
                    locationBtn.disabled = false;
                }
            }
        }
        
        // ç°¡åŒ–æœå°‹åŠŸèƒ½ (ä½¿ç”¨ Nominatim API)
        async function searchLocation(query) {
            try {
                console.log(`ğŸ” é–‹å§‹æœå°‹: ${query}`);
                
                // é è™•ç†æŸ¥è©¢å­—ä¸² - å˜—è©¦å¤šç¨®æ ¼å¼
                const searchQueries = [
                    query + ', Taiwan',
                    query + ', å°ç£',
                    query.replace(/å°åŒ—å¸‚|æ–°åŒ—å¸‚/, '') + ', Taipei, Taiwan',
                    query.replace(/å°ç£|å°åŒ—å¸‚|æ–°åŒ—å¸‚/, '') + ', Taiwan'
                ];
                
                // å¦‚æœæ˜¯è©³ç´°åœ°å€ï¼Œå˜—è©¦æ›´å¤šæ ¼å¼
                if (query.includes('è¡—') || query.includes('è·¯') || query.includes('è™Ÿ')) {
                    const addr = query.replace(/å°åŒ—å¸‚|æ–°åŒ—å¸‚|æ¡ƒåœ’å¸‚/, '').replace(/å€/, '');
                    searchQueries.push(addr + ', Taipei');
                    searchQueries.push(addr + ', Taiwan');
                    
                    // æå–è¡—é“åç¨±
                    const streetMatch = query.match(/([\u4e00-\u9fff]+è¡—|[\u4e00-\u9fff]+è·¯)/);
                    if (streetMatch) {
                        searchQueries.push(streetMatch[1] + ', Taipei, Taiwan');
                    }
                }
                
                // å˜—è©¦æ¯å€‹æœå°‹æŸ¥è©¢
                for (const searchQuery of searchQueries) {
                    console.log(`ğŸ” å˜—è©¦: ${searchQuery}`);
                    
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchQuery)}&limit=3&countrycodes=tw&addressdetails=1`);
                    const results = await response.json();
                    
                    if (results.length > 0) {
                        const result = results[0];
                        const lat = parseFloat(result.lat);
                        const lng = parseFloat(result.lon);
                        
                        map.setView([lat, lng], 17);
                        
                        // æ·»åŠ æœå°‹çµæœæ¨™è¨˜
                        const marker = L.marker([lat, lng]).addTo(map);
                        marker.bindPopup(`
                            <div style="text-align: center; padding: 5px;">
                                <h4 style="margin: 0 0 5px 0; font-weight: bold;">ğŸ“ ${result.display_name}</h4>
                                <button onclick="openInNativeMapFromPopup('${result.display_name.replace(/'/g, "\\'")}', ${lat}, ${lng})" 
                                        style="background: #f59e0b; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                    ğŸ—ºï¸ å°èˆª
                                </button>
                            </div>
                        `).openPopup();
                        
                        console.log(`âœ… æ‰¾åˆ°: ${result.display_name}`);
                        return;
                    }
                }
                
                // å¦‚æœéƒ½æ‰¾ä¸åˆ°ï¼Œé¡¯ç¤ºå»ºè­°
                alert(`æ‰¾ä¸åˆ° "${query}"\n\nğŸ’¡ å»ºè­°ï¼š\nâ€¢ è©¦è©¦ "ä¸­å±±å€èˆˆå®‰è¡—"\nâ€¢ æˆ–ä½¿ç”¨åœ°æ¨™åç¨±\nâ€¢ æˆ–ç°¡åŒ–ç‚ºè·¯åå¦‚ "èˆˆå®‰è¡—"`);
                
            } catch (error) {
                console.error('æœå°‹å¤±æ•—:', error);
                alert('æœå°‹å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
            }
        }
        
        // å¢å¼·ç‰ˆåœ°å€æœå°‹ - å¦‚æœä¸»æœå°‹å¤±æ•—ï¼Œå˜—è©¦Google Geocoding
        async function enhancedAddressSearch(query) {
            try {
                // é¦–å…ˆå˜—è©¦æ¨™æº–æœå°‹
                await searchLocation(query);
            } catch (error) {
                console.log('æ¨™æº–æœå°‹å¤±æ•—ï¼Œå˜—è©¦å¢å¼·æœå°‹...');
                
                // å‚™é¸æ–¹æ¡ˆï¼šä½¿ç”¨ä¸åŒçš„APIç«¯é»
                try {
                    const response = await fetch(`https://photon.komoot.io/api/?q=${encodeURIComponent(query + ' taiwan')}&limit=3`);
                    const data = await response.json();
                    
                    if (data.features && data.features.length > 0) {
                        const feature = data.features[0];
                        const [lng, lat] = feature.geometry.coordinates;
                        
                        map.setView([lat, lng], 17);
                        
                        const marker = L.marker([lat, lng]).addTo(map);
                        marker.bindPopup(`
                            <div style="text-align: center; padding: 5px;">
                                <h4 style="margin: 0 0 5px 0; font-weight: bold;">ğŸ“ ${feature.properties.name || query}</h4>
                                <p style="margin: 0 0 5px 0; font-size: 11px;">${feature.properties.city || ''}</p>
                                <button onclick="openInNativeMapFromPopup('${query}', ${lat}, ${lng})" 
                                        style="background: #f59e0b; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                    ğŸ—ºï¸ å°èˆª
                                </button>
                            </div>
                        `).openPopup();
                        
                        console.log('âœ… ä½¿ç”¨å‚™é¸æœå°‹æ‰¾åˆ°åœ°é»');
                    } else {
                        // æœ€å¾Œå»ºè­°
                        showDetailedSearchHelp(query);
                    }
                } catch (backupError) {
                    showDetailedSearchHelp(query);
                }
            }
        }
        
        // è©³ç´°æœå°‹èªªæ˜
        function showDetailedSearchHelp(query) {
            const helpText = `
æ‰¾ä¸åˆ° "${query}" ğŸ˜”

ğŸ” æœå°‹æŠ€å·§ï¼š
â€¢ å®Œæ•´åœ°å€ï¼šå°åŒ—å¸‚ä¸­å±±å€èˆˆå®‰è¡—
â€¢ ç°¡åŒ–åœ°å€ï¼šä¸­å±±å€èˆˆå®‰è¡—  
â€¢ åªç”¨è·¯åï¼šèˆˆå®‰è¡—
â€¢ é™„è¿‘åœ°æ¨™ï¼šä¸­å±±åœ‹å°ã€è¡Œå¤©å®®

ğŸ“ æ¨è–¦æ ¼å¼ï¼š
â€¢ å€åŸŸ + è¡—é“ï¼šã€Œä¸­å±±å€èˆˆå®‰è¡—ã€
â€¢ åœ°æ¨™åç¨±ï¼šã€Œå°åŒ—è»Šç«™ã€
â€¢ å•†åœˆåç¨±ï¼šã€Œè¥¿é–€ç”ºã€

ğŸ’¡ æç¤ºï¼šå°ç£çš„è©³ç´°é–€ç‰Œè™Ÿç¢¼å¯èƒ½ç„¡æ³•ç²¾ç¢ºæœå°‹ï¼Œ
å»ºè­°æœå°‹åˆ°è¡—é“å¾Œå†ä½¿ç”¨å°èˆªåŠŸèƒ½ã€‚
            `.trim();
            
            alert(helpText);
        }
        
        // é¡¯ç¤º/éš±è—åœ°æ¨™
        function toggleLandmarks() {
            if (landmarksVisible) {
                hideLandmarks();
            } else {
                showLandmarks();
            }
        }
        
        // é¡¯ç¤ºåœ°æ¨™
        function showLandmarks() {
            landmarks.forEach(landmark => {
                // å‰µå»ºè‡ªå®šç¾©åœ–æ¨™
                const customIcon = L.divIcon({
                    className: 'custom-landmark-marker',
                    html: `<div style="
                        background-color: ${landmark.color}; 
                        width: 40px; 
                        height: 40px; 
                        border-radius: 50%; 
                        border: 3px solid white; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        font-size: 16px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        cursor: pointer;
                    ">${landmark.icon}</div>`,
                    iconSize: [40, 40],
                    iconAnchor: [20, 20],
                    popupAnchor: [0, -20]
                });
                
                const marker = L.marker(landmark.position, { icon: customIcon }).addTo(map);
                
                // æ·»åŠ å½ˆå‡ºçª—å£
                marker.bindPopup(`
                    <div style="text-align: center; padding: 5px;">
                        <h4 style="margin: 0 0 5px 0; font-weight: bold;">${landmark.icon} ${landmark.name}</h4>
                        <p style="margin: 0 0 10px 0; color: #666; font-size: 12px;">${landmark.category}</p>
                        <button onclick="openInNativeMapFromPopup('${landmark.name}', ${landmark.position[0]}, ${landmark.position[1]})" 
                                style="background: #f59e0b; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                            ğŸ—ºï¸ å°èˆª
                        </button>
                    </div>
                `);
                
                // é»æ“Šåœ°æ¨™æ™‚è·³è½‰åˆ°åŸç”Ÿåœ°åœ–
                marker.on('click', () => {
                    openInNativeMap(landmark);
                });
                
                landmarkMarkers.push(marker);
            });
            
            landmarksVisible = true;
            document.getElementById('toggleLandmarks').textContent = 'éš±è—';
            document.getElementById('landmarksBtn').querySelector('i').classList.remove('text-secondary');
            document.getElementById('landmarksBtn').querySelector('i').classList.add('text-amber-600');
            
            console.log('ğŸ·ï¸ åœ°æ¨™å·²é¡¯ç¤º');
        }
        
        // éš±è—åœ°æ¨™
        function hideLandmarks() {
            landmarkMarkers.forEach(marker => {
                marker.remove();
            });
            landmarkMarkers = [];
            
            landmarksVisible = false;
            document.getElementById('toggleLandmarks').textContent = 'é¡¯ç¤º';
            document.getElementById('landmarksBtn').querySelector('i').classList.remove('text-amber-600');
            document.getElementById('landmarksBtn').querySelector('i').classList.add('text-secondary');
            
            console.log('ğŸ·ï¸ åœ°æ¨™å·²éš±è—');
        }
        
        // åœ¨åŸç”Ÿåœ°åœ–ä¸­æ‰“é–‹ (å¾å½ˆå‡ºçª—å£èª¿ç”¨)
        function openInNativeMapFromPopup(name, lat, lng) {
            const landmark = { name, position: [lat, lng] };
            openInNativeMap(landmark);
        }
        
        // åœ¨åŸç”Ÿåœ°åœ–ä¸­æ‰“é–‹
        function openInNativeMap(landmark) {
            const lat = landmark.position[0];
            const lng = landmark.position[1];
            const name = encodeURIComponent(landmark.name);
            
            // æª¢æ¸¬è¨­å‚™é¡å‹
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            // é¡¯ç¤ºé¸æ“‡å°è©±æ¡†
            const choice = confirm(`ğŸ—ºï¸ è¦åœ¨åœ°åœ–æ‡‰ç”¨ä¸­æ‰“é–‹ "${landmark.name}" å—ï¼Ÿ\n\nç¢ºå®šï¼šä½¿ç”¨åŸç”Ÿåœ°åœ–å°èˆª\nå–æ¶ˆï¼šç¹¼çºŒåœ¨ç¶²é ç€è¦½`);
            
            if (choice) {
                if (isIOS) {
                    // iOS: å˜—è©¦Apple Mapsï¼Œå¤±æ•—å‰‡ç”¨Google Maps
                    const appleMapsUrl = `maps://?q=${name}&ll=${lat},${lng}`;
                    const googleMapsUrl = `https://maps.google.com/maps?q=${lat},${lng}&z=15`;
                    
                    try {
                        window.location.href = appleMapsUrl;
                        // å¦‚æœApple Mapsæ²’æœ‰å®‰è£ï¼Œ1ç§’å¾Œè·³è½‰åˆ°Google Maps
                        setTimeout(() => {
                            window.open(googleMapsUrl, '_blank');
                        }, 1000);
                    } catch (e) {
                        window.open(googleMapsUrl, '_blank');
                    }
                } else if (isAndroid) {
                    // Android: ä½¿ç”¨Google Maps intent
                    const googleMapsUrl = `https://maps.google.com/maps?q=${lat},${lng}&z=15`;
                    window.open(googleMapsUrl, '_blank');
                } else {
                    // æ¡Œé¢ç‰ˆï¼šæ‰“é–‹Google Mapsç¶²é ç‰ˆ
                    const googleMapsUrl = `https://maps.google.com/maps?q=${lat},${lng}&z=15`;
                    window.open(googleMapsUrl, '_blank');
                }
                
                console.log(`ğŸš€ è·³è½‰åˆ°åŸç”Ÿåœ°åœ–: ${landmark.name}`);
            }
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–åœ°åœ–
            initMap();
            
            // æœå°‹æŒ‰éˆ•
            document.getElementById('searchBtn').addEventListener('click', () => {
                const query = document.getElementById('searchInput').value.trim();
                if (query) {
                    enhancedAddressSearch(query);
                }
            });
            
            // æœå°‹æ¡†Enteréµ
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const query = e.target.value.trim();
                    if (query) {
                        enhancedAddressSearch(query);
                    }
                }
            });
            
            // å¿«é€Ÿæœå°‹æŒ‰éˆ•
            document.querySelectorAll('.quick-search').forEach(btn => {
                btn.addEventListener('click', () => {
                    const location = btn.getAttribute('data-location');
                    document.getElementById('searchInput').value = location;
                    enhancedAddressSearch(location);
                });
            });
            
            // ç•¶å‰ä½ç½®æŒ‰éˆ• (å³ä¸Šè§’)
            document.getElementById('currentLocationBtn').addEventListener('click', () => {
                if (userLocation) {
                    map.setView(userLocation, 16);
                    if (currentLocationMarker) {
                        currentLocationMarker.openPopup();
                    }
                } else {
                    getCurrentLocation(false);
                }
            });
            
            // ä¸­å¤®å®šä½æŒ‰éˆ• (ä¸»è¦å®šä½åŠŸèƒ½)
            document.getElementById('centerLocationBtn').addEventListener('click', () => {
                getCurrentLocation(true); // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
            });
            
            // åœ°æ¨™æŒ‰éˆ•
            document.getElementById('landmarksBtn').addEventListener('click', toggleLandmarks);
            
            // åˆ‡æ›åœ°æ¨™æŒ‰éˆ•
            document.getElementById('toggleLandmarks').addEventListener('click', toggleLandmarks);
        });
        
        // ç¯©é¸æ¨™ç±¤åˆ‡æ›
        document.querySelectorAll('.filter-chip').forEach(chip => {
            chip.addEventListener('click', function() {
                document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
            });
        });
    </script>
</body>
</html> 